---
layout: single
title:  "ë¨¸ì‹ ëŸ¬ë‹ 9ì°¨ê³¼ì œ"
---

# **ML ëª¨ë¸ ì‚¬ìš©í•˜ì—¬ Web App ë§Œë“¤ê¸°**

__UFO ëª©ê²© ì§€ì—­ ë°ì´í„°ì…‹ì„ ì´ìš©í•˜ì—¬ ëª¨ë¸ì„ í›ˆë ¨í•  ê²ƒì´ë‹¤.__

ì´ë²ˆ í•™ìŠµì—ì„œ ì•„ë˜ì™€ ê°™ì€ ë°©ì‹ì„ ë°°ìš¸ ìˆ˜ ìˆë‹¤.
>- í›ˆë ¨ëœ ëª¨ë¸ì„ pickle í•˜ëŠ” ë°©ì‹
>- Flask ì•±ì—ì„œ ëª¨ë¸ì„ ì‚¬ìš©í•˜ëŠ” ë°©ì‹

#### __ì‚¬ìš©í•  ë„êµ¬__
> __*Pickle*__ ì€ íŒŒì´ì¬ ê°ì²´ êµ¬ì¡°ë¥¼ serializesì™€ de-serializesí•˜ëŠ” íŒŒì´ì¬ ëª¨ë“ˆì´ë‹¤.
>__*Flask*__ ëŠ” íŒŒì´ì¬ìœ¼ë¡œ ì›¹ì˜ ê¸°ë³¸ì ì¸ ê¸°ëŠ¥ê³¼ ì›¹ í˜ì´ì§€ë¥¼ ë§Œë“œëŠ” í…œí”Œë¦¿ ì—”ì§„ì„ ì œê³µí•´ ì¤€ë‹¤.

#### __ë°ì´í„° ì •ë¦¬__
__*NUFORC (The National UFO Reporting Center)*__ ì—ì„œ ëª¨ì•„ë‘”, 80,000 UFO ëª©ê²© ë°ì´í„° ì…‹ì„ ì‚¬ìš©í•œë‹¤.

__*ufos.csv*__ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì—ëŠ” ëª©ê²©ëœ __city__, __state__, __country__, UFOì˜ __shape__ ì™€ __latitude__ ë° __longitude__ ì—´ì´ í¬í•¨ë˜ì–´ ìˆë‹¤.

ipynb íŒŒì¼ì„ í•˜ë‚˜ ìƒì„±í•˜ì—¬ ì§„í–‰í•œë‹¤.

1) pandas, matplotlib, numpyë¥¼ ë¶ˆëŸ¬ì˜¤ê³  __*ufos.csv*__ íŒŒì¼ë„ ë¶ˆëŸ¬ì˜¨ë‹¤. ufos.head()ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒ˜í”Œ ë°ì´í„°ì…‹ì„ ë³¼ ìˆ˜ ìˆë‹¤.


```python
import pandas as pd
import numpy as np

ufos = pd.read_csv('./ufos.csv')
ufos.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>city</th>
      <th>state</th>
      <th>country</th>
      <th>shape</th>
      <th>duration (seconds)</th>
      <th>duration (hours/min)</th>
      <th>comments</th>
      <th>date posted</th>
      <th>latitude</th>
      <th>longitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10/10/1949 20:30</td>
      <td>san marcos</td>
      <td>tx</td>
      <td>us</td>
      <td>cylinder</td>
      <td>2700.0</td>
      <td>45 minutes</td>
      <td>This event took place in early fall around 194...</td>
      <td>4/27/2004</td>
      <td>29.883056</td>
      <td>-97.941111</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10/10/1949 21:00</td>
      <td>lackland afb</td>
      <td>tx</td>
      <td>NaN</td>
      <td>light</td>
      <td>7200.0</td>
      <td>1-2 hrs</td>
      <td>1949 Lackland AFB&amp;#44 TX.  Lights racing acros...</td>
      <td>12/16/2005</td>
      <td>29.384210</td>
      <td>-98.581082</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10/10/1955 17:00</td>
      <td>chester (uk/england)</td>
      <td>NaN</td>
      <td>gb</td>
      <td>circle</td>
      <td>20.0</td>
      <td>20 seconds</td>
      <td>Green/Orange circular disc over Chester&amp;#44 En...</td>
      <td>1/21/2008</td>
      <td>53.200000</td>
      <td>-2.916667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10/10/1956 21:00</td>
      <td>edna</td>
      <td>tx</td>
      <td>us</td>
      <td>circle</td>
      <td>20.0</td>
      <td>1/2 hour</td>
      <td>My older brother and twin sister were leaving ...</td>
      <td>1/17/2004</td>
      <td>28.978333</td>
      <td>-96.645833</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10/10/1960 20:00</td>
      <td>kaneohe</td>
      <td>hi</td>
      <td>us</td>
      <td>light</td>
      <td>900.0</td>
      <td>15 minutes</td>
      <td>AS a Marine 1st Lt. flying an FJ4B fighter/att...</td>
      <td>1/22/2004</td>
      <td>21.418056</td>
      <td>-157.803611</td>
    </tr>
  </tbody>
</table>
</div>



2) ufos ë°ì´í„°ë¥¼ ìƒˆë¡œìš´ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜í•œë‹¤. Country í•„ë“œê°€ ìœ ë‹ˆí¬ ê°’ì¸ì§€ í™•ì¸í•œë‹¤.


```python
ufos = pd.DataFrame({'Seconds': ufos['duration (seconds)'], 'Country': ufos['country'],'Latitude': ufos['latitude'],'Longitude': ufos['longitude']})

ufos.Country.unique()
```




    array(['us', nan, 'gb', 'ca', 'au', 'de'], dtype=object)



3) ëª¨ë“  ëˆ„ë½ê°’ì„ .dropnaë¥¼ ì‚¬ìš©í•˜ì—¬ ë“œëí•˜ê³ , 1~60ì´ˆ ì‚¬ì´ ëª©ê²© ë°ì´í„°ë§Œ ë¶ˆëŸ¬ì™€ì„œ ë°ì´í„° ì²˜ë¦¬ëŸ‰ì„ ì¤„ì¸ë‹¤.


```python
ufos.dropna(inplace=True)

ufos = ufos[(ufos['Seconds'] >= 1) & (ufos['Seconds'] <= 60)]

ufos.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 25863 entries, 2 to 80330
    Data columns (total 4 columns):
     #   Column     Non-Null Count  Dtype  
    ---  ------     --------------  -----  
     0   Seconds    25863 non-null  float64
     1   Country    25863 non-null  object 
     2   Latitude   25863 non-null  float64
     3   Longitude  25863 non-null  float64
    dtypes: float64(3), object(1)
    memory usage: 1010.3+ KB
    

4) ì‚¬ì´í‚· ëŸ°ì˜ __*LabelEncoder*__ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì™€ì„œ êµ­ê°€ì˜ í…ìŠ¤íŠ¸ ê°’ì„ ìˆ«ìë¡œ ë³€í™˜í•œë‹¤.

ì•„ë˜ì™€ ê°™ì´ ë°ì´í„°ê°€ ì¶•ì•½ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.


```python
from sklearn.preprocessing import LabelEncoder

ufos['Country'] = LabelEncoder().fit_transform(ufos['Country'])

ufos.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Seconds</th>
      <th>Country</th>
      <th>Latitude</th>
      <th>Longitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>20.0</td>
      <td>3</td>
      <td>53.200000</td>
      <td>-2.916667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>20.0</td>
      <td>4</td>
      <td>28.978333</td>
      <td>-96.645833</td>
    </tr>
    <tr>
      <th>14</th>
      <td>30.0</td>
      <td>4</td>
      <td>35.823889</td>
      <td>-80.253611</td>
    </tr>
    <tr>
      <th>23</th>
      <td>60.0</td>
      <td>4</td>
      <td>45.582778</td>
      <td>-122.352222</td>
    </tr>
    <tr>
      <th>24</th>
      <td>3.0</td>
      <td>3</td>
      <td>51.783333</td>
      <td>-0.783333</td>
    </tr>
  </tbody>
</table>
</div>



#### __ëª¨ë¸ êµ¬ì¶•__

ì‚¬ì´í‚· ëŸ°ì˜ __*train_test_split*__ ì„ ì´ìš©í•˜ì—¬ ë°ì´í„° ì…‹ì„ í›ˆë ¨ ì…‹ê³¼ í…ŒìŠ¤íŠ¸ ì…‹ìœ¼ë¡œ ë¶„ë¦¬í•˜ê³  ëª¨ë¸ì„ í›ˆë ¨ ì‹œí‚¨ë‹¤. 

1) X ë²¡í„°ì— 3ê°€ì§€ íŠ¹ì„±[__*'Seconds','Latitude','Longitude'*__]ì„ ì„ íƒí•˜ë©´, y ë²¡í„°ëŠ” __*Country*__ ê°€ ëœë‹¤. 


```python
from sklearn.model_selection import train_test_split

Selected_features = ['Seconds','Latitude','Longitude']

X = ufos[Selected_features]
y = ufos['Country']

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=0)
```

2) ë¡œì§€ìŠ¤í‹± íšŒê·€ ëª¨ë¸ì„ í›ˆë ¨í•´ë³´ë‹ˆ, ë‚˜ë¼ì™€ ìœ„ë„,ê²½ë„ì˜ ìƒê´€ ê´€ê³„ ë•ë¶„ì— ì •í™•ë„ëŠ” 97%ê°€ ë‚˜ì™”ë‹¤. ì´ ëª¨ë¸ì€ __*Latitude*__ ì™€ __*Longitude*__ ë¥¼ ì•Œì•„ì•¼ í•´ì„œ ì¢‹ì€ ëª¨ë¸ì€ ì•„ë‹ˆì§€ë§Œ, ì—°ìŠµìœ¼ë¡œ ì›¹ì•±ì„ ë§Œë“¤ì–´ ë³´ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ê´œì°®ë‹¤.

__*ConvergenceWarning*__ ì„ í•´ê²°í•˜ê¸° ìœ„í•´ `max_iter` ê°’ì„ ì„¤ì •í•´ ì¤€ë‹¤.


```python
from sklearn.metrics import accuracy_score, classification_report 
from sklearn.linear_model import LogisticRegression
model = LogisticRegression(max_iter=1000)
model.fit(X_train, y_train)
predictions = model.predict(X_test)

print(classification_report(y_test, predictions))
print('Predicted labels: ', predictions)
print('Accuracy: ', accuracy_score(y_test, predictions))
```

                  precision    recall  f1-score   support
    
               0       1.00      1.00      1.00        41
               1       0.85      0.47      0.60       250
               2       1.00      1.00      1.00         8
               3       1.00      1.00      1.00       131
               4       0.97      1.00      0.98      4743
    
        accuracy                           0.97      5173
       macro avg       0.96      0.89      0.92      5173
    weighted avg       0.97      0.97      0.97      5173
    
    Predicted labels:  [4 4 4 ... 3 4 4]
    Accuracy:  0.9702300405953992
    

#### __ëª¨ë¸ì— 'pickle' ë°©ì‹ ì‚¬ìš©í•˜ê¸°__

- __*pickle*__ ì€ í…ìŠ¤íŠ¸ ì´ì™¸ì˜ ìë£Œí˜•ì„ íŒŒì¼ë¡œ ì €ì¥í•˜ê¸° ìœ„í•´ ì œê³µë˜ëŠ” ëª¨ë“ˆì´ë‹¤. ì²˜ë¦¬í•œ ë°ì´í„°ë¥¼ ë‹¤ë¥¸ ê³³ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.

pickleëœ ëª¨ë¸ì„ ë¶ˆëŸ¬ì™€ì„œ second, letitude, longitudeì˜ ê°’ì´ í¬í•¨ëœ ìƒ˜í”Œ ë°ì´í„° ë°°ì—´ì„ ëŒ€ìƒìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í•œë‹¤.

ì˜êµ­ì˜ êµ­ê°€ ì½”ë“œì¸, [3]ì´ ë°˜í™˜ì´ ëœë‹¤.


```python
import pickle
model_filename = 'ufo-model.pkl'
pickle.dump(model, open(model_filename,'wb'))

model = pickle.load(open('ufo-model.pkl','rb'))
print(model.predict([[50,44,-12]]))
```

    [3]
    

    c:\users\user\appdata\local\programs\python\python37\lib\site-packages\sklearn\base.py:451: UserWarning: X does not have valid feature names, but LogisticRegression was fitted with feature names
      "X does not have valid feature names, but"
    

#### __Flask ì•± êµ¬ì¶•__

1) __*ufo_model.pkl*__ íŒŒì¼ê³¼ __*notebook.ipynb*__ íŒŒì¼ê³¼ ê°™ì€ ìœ„ì¹˜ì— __*web-app*__ í´ë”ë¥¼ ìƒì„±í•œë‹¤.

![1](https://user-images.githubusercontent.com/72372133/170319126-458782c5-9dc6-42c0-ba13-a1ceeccec484.png)


2) __*web-app*__ í´ë”ì— __static__ ê³¼ __templates__ í´ë”ë¥¼ ìƒì„±í•´ ì¤€ë‹¤.

![2](https://user-images.githubusercontent.com/72372133/170319276-ba6786ae-93fd-4abb-9e05-207abcdbf817.png)

3) __static__ í´ë” ë‚´ì— __css__ í´ë”ë¥¼ í•˜ë‚˜ ë” ìƒì„±í•´ì¤€ë‹¤.

![3](https://user-images.githubusercontent.com/72372133/170319306-35108302-f4b6-42e9-952f-a984381184ba.png)

4) __*web-app*__ í´ë” ë‚´ì— __requirement.txt__ íŒŒì¼ì„ ìƒì„±í•´ì¤€ í›„, ì•„ë˜ ë‚´ìš©ë“¤ì„ ì ê³   ì €ì¥í•œë‹¤.

![4](https://user-images.githubusercontent.com/72372133/170319345-a529f4c3-f2c7-4baa-a874-ea1c0793e265.png)


```python
scikit-learn
pandas
numpy
flask
```

5) `pip install`ë¡œ __requirements.txt__ ì— ì‘ì„±ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ ì„¤ì¹˜í•œë‹¤.


```python
pip install -r requirements.txt
```

6) __css__ í´ë” ë‚´ì— __styles.css__ íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í›„ ì €ì¥í•´ ì¤€ë‹¤.

![7](https://user-images.githubusercontent.com/72372133/170319367-b49447a5-0bd4-4262-a352-43b87d44e2de.png)


```python
body {
	width: 100%;
	height: 100%;
	font-family: 'Helvetica';
	background: black;
	color: #fff;
	text-align: center;
	letter-spacing: 1.4px;
	font-size: 30px;
}

input {
	min-width: 150px;
}

.grid {
	width: 300px;
	border: 1px solid #2d2d2d;
	display: grid;
	justify-content: center;
	margin: 20px auto;
}

.box {
	color: #fff;
	background: #2d2d2d;
	padding: 12px;
	display: inline-block;
}
```

7) __templates__ í´ë” ë‚´ì— __index.html__ íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í›„ ì €ì¥í•´ ì¤€ë‹¤.

![6](https://user-images.githubusercontent.com/72372133/170319414-1152a2a9-0a9c-4d1b-a296-763ffab4bc57.png)


```python
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ğŸ›¸ UFO ëª©ê²© ì˜ˆì¸¡! ğŸ‘½</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='./web-app/static/css/styles.css') }}"> 
</head>

<body>
 <div class="grid">

  <div class="box">

  <p>'ì´ˆ','ìœ„ë„','ê²½ë„'ë¥¼ ì…ë ¥í•˜ì—¬ ì–´ë–¤ ë‚˜ë¼ê°€ UFOë¥¼ ëª©ê²©í–ˆì„ì§€ ì˜ˆì¸¡í•´ ë³´ì!</p>

    <form action="{{ url_for('predict')}}" method="post">
    	<input type="number" name="seconds" placeholder="Seconds" required="required" min="0" max="60" />
      <input type="text" name="latitude" placeholder="Latitude" required="required" />
		  <input type="text" name="longitude" placeholder="Longitude" required="required" />
      <button type="submit" class="btn"> UFOë¥¼ ëª©ê²©í•œ ë‚˜ë¼ ì˜ˆì¸¡</button>
    </form>

  
   <p>{{ prediction_text }}</p>

 </div>
</div>

</body>
</html>
```

8) __*web-app*__ í´ë”ì— __app.py__ ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í›„ ì €ì¥í•œë‹¤.

![5](https://user-images.githubusercontent.com/72372133/170319457-a1c0cf0c-d7b9-430f-bb1a-55be976baea7.png)


```python
import numpy as np
from flask import Flask, request, render_template
import pickle

app = Flask(__name__)

model = pickle.load(open("./ufo-model.pkl", "rb"))


@app.route("/")
def home():
    return render_template("index.html")


@app.route("/predict", methods=["POST"])
def predict():

    int_features = [int(x) for x in request.form.values()]
    final_features = [np.array(int_features)]
    prediction = model.predict(final_features)

    output = prediction[0]

    countries = ["Australia", "Canada", "Germany", "UK", "US"]

    return render_template(
        "index.html", prediction_text="ëª©ê²©í•œ ë‚˜ë¼: {}".format(countries[output])
    )


if __name__ == "__main__":
    app.run(debug=True)
```

9) ì´ì œ ëª…ë ¹í”„ë¡¬í”„íŠ¸ ì°½ì—ì„œ `python ./web-app/app.py`ë¥¼ ì‹¤í–‰í•˜ë©´ ëª…ë ¹í”„ë¡¬í”„íŠ¸ ì°½ì— ì•„ë˜ì™€ ê°™ì´ ì¶œë ¥ë˜ê³ , ì›¹ ì„œë²„ê°€ ë¡œì»¬í˜¸ìŠ¤íŠ¸ì—ì„œ ì‹œì‘í•˜ê²Œ ëœë‹¤.

![app](https://user-images.githubusercontent.com/72372133/170319520-0092ab57-ce8e-4eb6-81ab-363e3b78eb94.png)

#### ì›¹ ì•± ì‹¤í–‰ ê²°ê³¼

ì¸í„°ë„· ì£¼ì†Œì°½ì— 127.0.0.1:5000ì„ ì…ë ¥í•˜ë©´ UFOê°€ ëª©ê²©ëœ ì¥ì†Œì— ëŒ€í•´ ì´ˆ, ìœ„ë„, ê²½ë„ë¥¼ ì´ìš©í•˜ì—¬ ì§§ì€ ë‹µì„ ì–»ì„ ìˆ˜ ìˆê²Œ ëœë‹¤.

![web1](https://user-images.githubusercontent.com/72372133/170319606-3e0ef5fa-7c2c-480d-b993-a8b4a52ecc23.png)

ì´ì „ì— __*seconds*__ ëŠ” 50, __*Latitude*__ ëŠ” 44, __*Longitude*__ ëŠ” -12 ë¡œ í–ˆì„ ë•Œ ì˜êµ­ì˜ êµ­ê°€ ì½”ë“œì¸ [3]ì„ ë°˜í™˜ í–ˆëŠ”ë°, ì›¹ ì•±ì—ì„œë„ ë™ì¼í•œ ì˜ˆì¸¡ ê²°ê³¼ê°€ ë‚˜ì˜¤ëŠ”ì§€ ë³´ì•˜ë‹¤.

![web2](https://user-images.githubusercontent.com/72372133/170319630-9303c799-d29e-47cf-98ee-0817756d286b.png)
![web3](https://user-images.githubusercontent.com/72372133/170319644-5aecbc91-9303-4c1d-8399-2ff14b04e583.png)

ì›¹ ì•±ì—ì„œë„ ì˜ˆì¸¡ êµ­ê°€ë¡œ UK, ì˜êµ­ì„ ë°˜í™˜í•œ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
